<!DOCTYPE HTML>
<html>
<head>
	<hta:application
   showintaskbar = "no"
   caption = "no"
   border = "thick"
   contextmenu = "no"
   icon = "path_to_icon.ico"
   innerborder = "no"
   scroll = "no"
   singleinstance = "yes"
   resizable = "no"
   windowState = "maximize"
>
  <title>MetroidVania</title>
  <meta name="description" content="melonJS homepage" />
  <meta name="keywords" content="melonJS, HTML5, javascript, game, engine, framework" />
  <!-- <link rel="stylesheet" type="text/css" href="http://nsjof.org/game/melonEx/melonJS/examples/platformer//style/style.css" title="style" /> -->
	<style type="text/css">
		canvas {
			display: block;
			tabindex:1;
			image-rendering: optimizeSpeed;
			image-rendering: -moz-crisp-edges;
			image-rendering: -o-crisp-edges;
			image-rendering: -webkit-optimize-contrast;
			image-rendering: optimize-contrast;
			-ms-interpolation-mode: nearest-neighbor;
		}
	</style>
  </head>

 <!--  <div id="main">
    <div id="site_content"> -->
<!-- 		<center>
		<div id="content"> -->
			<!-- Canvas -->
			<div id="screen" style=""></div>

			<!-- Right Login Screen -->
		<!-- 	<div id="signin" style="float:left; width:15%; margin:15px;">
				<h1>Please enter your name</h1>
				<input type='text' id='userNameField'>
				<button value='Start' onclick='userName = $("#userNameField").val(); socketResponse("setname", $("#userNameField").val()); $("#signin").hide();'>Start</button>
			</div>

			<div id="userhead" style="float:left; width:15%; margin:15px;"><h1>User List: id#<script>document.write(clientid)</script></h1><hr>
				<div id="leave"><button onclick='socketResponse("leave", userName); window.location = "http://www.google.com/";'>Leave</button></div>
				<div id="userlist" style=""></div>
			</div> -->


 <script type="text/javascript" src="build/melonJS-0.9.7.js"></script>
 <script type="text/javascript" src="plugins/debug/debugPanel.js"></script>
 <script type="text/javascript" src="entities/screen.js"></script>
 <script type="text/javascript" src="entities/playerEntity.js"></script>
 <script type="text/javascript" src="entities/player2Entity.js"></script>
 <script type="text/javascript" src="entities/enemyEntities.js"></script>
 <script type="text/javascript" src="entities/itemEntities.js"></script>
 <script type="text/javascript" src="entities/weaponEntity.js"></script>
 <script type="text/javascript" src="entities/npcEntity.js"></script>
 <script src="tools/Iuppiter.js"></script>
 <script type="text/javascript" src="main.js"></script>
 <script src="/socket.io/socket.io.js"></script>
<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js'></script>
<script type='text/javascript' src="//rawgit.com/WebReflection/circular-json/master/build/circular-json.js"></script>
<script>

	var clientid = '';
	var clientData = new Array();
	var globalClientIndex;
	var users;
	var usersClient;
	var userName = '';
    var playerX = '';
	var playerY = '';
	var playerVelX = '';
	var playerVelY = '';
	var userlist = '';
	var currentAnim = '';
	var usernumber;
	var moveLeft = false;
	var moveRight = false;
	var left = false;
	var right = false;
	var up = false;
	var player2Action = '';
	var coinid = null;
	var levelDirection = '';
	var levelDirectionY = '';
	var playerMap = '';
	var visiblePlayer = '';
	var socketUpdated = '';
	var playerXlast = '';
	var playerYlast = '';
	var nextScreenY = '';
	var nextScreenX = '';
	var nextScreenVelX = '';
	var menuSelected = 0;
	var samemap = '';
	var capXP = 15;
	var capHP = 25;
	var lastLevelHeight = '';
	var playerInfo = new Object();
	var socketObjects = [];

	// Info
	playerInfo.xp = 0;
	playerInfo.lvl = 1;
	playerInfo.strength = 3;
	playerInfo.hitpoints = 50;
	playerInfo.hearts = 10;

	// Weapons
	playerInfo.weapons = new Array();
	playerInfo.weapons = ['whip'];


	var lvlcap = Array();
	for(i=1; i<50; i++) {
		capXP += 30;
		lvlcap[i] = capXP;
	}

	var lvlMaxHealth = Array();
	for(i=1; i<50; i++) {
		capHP += 20;
		lvlMaxHealth[i] = capHP;
	}

	var socketHost = location.host;
	var socket = io.connect(socketHost);

	socket.on('assignid', function (id) {
		clientid = id;
	});

    socket.on('removeplayer', function (clientid) {
    	playerX.splice(clientid, 1);
    	playerY.splice(clientid, 1);
    });

    socket.on('updateobjects', function (objects) {
    	if (objects.length > 0 && clientid > 0) {
    		compressedObjects = JSON.parse(objects);
    		socketObjects = compressedObjects;
    	}
    	// console.log(objects);
    });

    // Passing input from browser to socket.io server
	function socketResponse(type, data) {
		var socket = io.connect(socketHost);
	 	socket.emit(type, data);
	}

	// setInterval(function(){
	// 	console.log(socketObjects);
	// }, 2500);

	setInterval(function(){
		// If Host, update all socketObjects to server
		if (socketObjects.length > 0 && clientid == 0) {
			var stringSocketObjects = JSON.stringify(socketObjects);
			socketResponse('updateobjects', stringSocketObjects);
		}

		// If not Host, read objects from Server and add to game if  added yet
		if (socketObjects && clientid > 0 && me.state.ready) {
			for(var i = 0; i < socketObjects.length; i++) {
				var foundGameObj = false;
				//console.log(me.game.getEntityByGUID(socketObjects[i].GUID));
				if (me.game.getEntityByGUID(socketObjects[i].GUID) !== null) {
					foundGameObj = true;
				}
				if (!foundGameObj) {
					// console.log('created');
					// var skeleton = new SkeletonEnemyEntity( socketObjects[i].pos.x, socketObjects[i].pos.y, { image: "skeleton", spritewidth: 240, spriteheight: 240, animationspeed: 10, gravity: 0 });
					var hostedEntity = new SkullEnemyEntity( socketObjects[i].pos.x, socketObjects[i].pos.y, { image: "flyingdemon", spritewidth: 120, spriteheight: 120, GUID: socketObjects[i].GUID});
		 			me.game.add(hostedEntity, 100);
					me.game.sort();
					break;
				}
			}
	    }
  	}, 50);

</script>
</body>
</html>
